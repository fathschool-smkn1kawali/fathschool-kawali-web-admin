import{C as S}from"./auto.4bbfcea2.js";import{_ as M}from"./AppLayout.8b90d46b.js";import{_ as N,a9 as j,aa as E,N as R,u as U,f as P,Z as L,o,c as V,w as u,g as c,t as a,a as _,b as e,C as q,s as x,a3 as b,e as n,i as y,F as h,r as m,j as A,V as K,W as X}from"./app.9bacd1a0.js";import{_ as Y}from"./Modal.d266a93d.js";import"./TopBarMenu.978fcd11.js";import"./CheckCircleIcon.14efd96d.js";import"./shepherd.esm.8b0b6bfa.js";import"./XMarkIcon.db621c27.js";import"./WarningToast.5000d5fb.js";import"./NavLink.7e4b7702.js";import"./PlusCircleIcon.7b47160e.js";import"./UserIcon.2090e4c3.js";import"./Bars3Icon.559bf817.js";const z={components:{AppLayout:M,Breadcrumb:j,BreadcrumbLink:E,NothingFound:R,ExportModal:Y},props:{attendanceteacher:{type:Array,required:!0},absentTeachers:{type:Array,required:!0},filter_data:Object,study_programs:Object,attendance_percentage:Object,absence_percentage:Object},data(){const t=new Date().toISOString().slice(0,10),s=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().slice(0,10);return{loading:!1,options:[],options2:[],export_options:[],visible:!1,export_visible:!1,show_user:"",export_data:U({type:"Excel",study_program:"all"}),filter:{name:this.filter_data.keyword||"",start_date:this.filter_data.start_date||s,end_date:this.filter_data.end_date||t,study_program:this.filter_data.study_program||null}}},watch:{filter_data:{handler(t){const s=new Date().toISOString().slice(0,10),i=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().slice(0,10);this.filter.name=t.keyword||"",this.filter.start_date=t.start_date||i,this.filter.end_date=t.end_date||s,this.filter.study_program=t.study_program||null},immediate:!0}},mounted(){const t=document.getElementById("attendanceChart"),s={datasets:[{label:"Attendance",data:[this.attendance_percentage,this.absence_percentage],backgroundColor:["rgb(54, 162, 235)","rgb(255, 99, 132)"],hoverOffset:4}]};new S(t,{type:"doughnut",data:s,options:{responsive:!0,maintainAspectRatio:!1}});const i=document.getElementById("absenceChart"),l={datasets:[{label:"Absence",data:[this.absence_percentage,this.attendance_percentage],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]};new S(i,{type:"doughnut",data:l,options:{responsive:!0,maintainAspectRatio:!1}})},created(){this.options.push({value:"",label:"All"});for(const[t,s]of Object.entries(this.study_programs))this.options.push({value:s.slug,label:s.name})},setup(t){return{attendanceteacher:P(t.attendanceteacher)}},computed:{filteredAttendance(){return this.attendanceteacher.filter(t=>{let s=!0,i=!0;return this.filter.name.trim()!==""&&(s=t.user.name.toLowerCase().includes(this.filter.name.trim().toLowerCase())),this.filter.month!==""&&(i=new Date(t.date).toISOString().slice(0,7)===this.filter.month),s&&i})},filteredAbsent(){return this.absentTeachers.filter(s=>{let i=!0,l=!0;return this.filter.name.trim()!==""&&(i=s.user_name.toLowerCase().includes(this.filter.name.trim().toLowerCase())),this.filter.month!==""&&(l=new Date(s.date).toISOString().slice(0,7)===this.filter.month),i&&l})}},methods:{handleFocus(t){},handleBlur(t){},handleChange(t){},filterOption(t,s){return s.label.toLowerCase().indexOf(t.toLowerCase())>=0},filterData(){this.loading=!0;const t={keyword:this.filter.name.trim()!==""?this.filter.name.trim().toLowerCase():null,start_date:this.filter.start_date,end_date:this.filter.end_date,study_program:this.filter.study_program};this.$inertia.get(this.route("teacher.attendance"),t,{preserveScroll:!0,onFinish:()=>{this.loading=!1}})},exportAttendance(){this.loading=!0;let t={};this.filter.name.trim()!==""&&(t.name=this.filter.name.trim()),this.filter.start_date!==""&&(t.start_date=this.filter.start_date),this.filter.end_date!==""&&(t.end_date=this.filter.end_date),this.filter.study_program&&this.filter.study_program.trim()!==""&&(t.study_program=this.filter.study_program.trim()),L({url:this.route("teacherattendance.export"),method:"POST",data:t,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},responseType:"blob"}).then(s=>{console.log("Response received");var i=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=i;const d=`teacherattendance-report-${this.filter.start_date}-to-${this.filter.end_date}.xlsx`;l.setAttribute("download",d),document.body.appendChild(l),l.click(),this.loading=!1,this.visible=!1}).catch(s=>{console.error("Export error:",s),console.log("Error response:",s.response),this.loading=!1,this.visible=!1})},exportAbsent(){this.loading=!0;let t={};this.filter.name.trim()!==""&&(t.name=this.filter.name.trim()),this.filter.month!==""&&(t.month=this.filter.month),this.filter.course&&this.filter.course.trim()!==""&&(t.course=this.filter.course.trim()),this.filter.study_program&&this.filter.study_program.trim()!==""&&(t.study_program=this.filter.study_program.trim()),L({url:this.route("teacherabsent.export"),method:"POST",data:{...this.export_data,...t},headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},responseType:"blob"}).then(s=>{this.export_data.type;var i=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=i,l.setAttribute("download","teacherabsent-report.xlsx"),document.body.appendChild(l),l.click(),this.loading=!1,this.visible=!1}).catch(s=>{this.loading=!1,this.visible=!1})}}},v=t=>(K("data-v-282505a5"),t=t(),X(),t),W={class:"mb-4"},Z={class:"flex items-center"},G={class:"ml-4 flex items-center"},H={for:"start_date",class:"mr-2"},J={class:"ml-4 flex items-center"},Q={for:"end_date",class:"mr-2"},$={type:"submit",class:"ml-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},tt={class:"grid grid-cols-1 gap-6 xl:grid-cols-3 items-start mb-6"},et={class:"flex flex-col gap-4 rounded-lg bg-white overflow-x-auto dark:bg-gray-800 p-6"},st={class:"flex flex-col items-center justify-center w-full h-64 mb-5"},at=v(()=>e("canvas",{id:"attendanceChart",class:"mb-4 h-full"},null,-1)),rt={class:"text-center text-lg font-bold text-sky-500"},ot={class:"flex flex-col items-center justify-center w-full h-64"},nt=v(()=>e("canvas",{id:"absenceChart",class:"mb-4 h-full"},null,-1)),it={class:"text-center text-lg font-bold text-rose-400"},lt={class:"xl:col-span-2 bg-white dark:bg-gray-800 rounded-lg"},dt={class:"flex justify-between px-6 items-center pt-6 text-gray-900 dark:text-gray-400 text-base font-bold mb-2"},ct={class:"ml-auto"},ht={class:"overflow-x-auto overflow-y-auto max-h-[400px]"},_t={class:"w-full text-sm text-left text-gray-500 dark:text-gray-400"},pt={class:"text-xs text-gray-500 uppercase"},ut={scope:"col",class:"py-3 px-6"},mt={scope:"col",class:"py-3 px-6"},ft={scope:"col",class:"py-3 px-6"},yt={scope:"col",class:"py-3 px-6"},gt={scope:"col",class:"py-3 px-6"},xt={scope:"col",class:"py-3 px-6"},bt={scope:"col",class:"py-3 px-6"},vt={scope:"col",class:"py-3 px-6"},wt={class:"py-4 px-5 text-gray-900 dark:text-white"},kt={class:"py-4 px-5 text-gray-900 dark:text-white"},Ct={key:0,class:"font-bold"},St={class:"py-4 px-5 text-gray-900 dark:text-white"},Lt={class:"py-4 px-5 text-gray-900 dark:text-white"},At={class:"py-4 px-5 text-gray-900 dark:text-white"},Ot={class:"py-4 px-5 text-gray-900 dark:text-white"},Dt={class:"py-4 px-5 text-gray-900 dark:text-white"},Tt={class:"py-4 px-5 text-gray-900 dark:text-white"},Bt={key:1},Ft={colspan:"9",class:"text-center p-4"},It={class:"xl:col-span-2 bg-white dark:bg-gray-800 rounded-lg"},Mt={class:"flex justify-between items-center px-6 py-4"},Nt={class:"text-gray-900 dark:text-gray-400 text-lg font-bold"},jt={class:"py-4 px-5"},Et={class:"py-4 px-5"},Rt={class:"py-4 px-5"},Ut={class:"py-4 px-5"},Pt={class:"py-4 px-5"},Vt={class:"py-4 px-5 text-gray-900 dark:text-white"},qt={class:"py-4 px-5 text-gray-900 dark:text-white"},Kt={key:0,class:"font-bold"},Xt={class:"py-4 px-5 text-gray-900 dark:text-white"},Yt={class:"py-4 px-5 text-gray-900 dark:text-white"},zt={key:0,class:"flex flex-wrap items-center gap-0.5"},Wt={class:"py-4 px-5 text-gray-900 dark:text-white"},Zt={key:0,class:"flex flex-wrap items-center gap-0.5"},Gt={key:1},Ht={colspan:"9",class:"text-center p-4"},Jt=v(()=>e("div",{class:"flex justify-center"},null,-1));function Qt(t,s,i,l,d,p){const O=m("BreadcrumbLink"),D=m("Breadcrumb"),T=m("page-header"),B=m("a-select"),w=m("global-button"),k=m("NothingFound"),F=m("global-table"),I=m("AppLayout");return o(),V(I,{title:t.__("Teacher Attendance")},{header:u(()=>[c(a(t.__("Teacher Attendance")),1)]),default:u(()=>[_(D,null,{default:u(()=>[_(O,{title:t.__("Teacher Attendance"),href:t.route("teacher.class")},null,8,["title","href"])]),_:1}),e("div",null,[_(T,{class:"flex-col sm:flex-row"},{default:u(()=>[c(a(t.__("Teacher Attendance")),1)]),_:1}),e("div",W,[e("form",{onSubmit:s[4]||(s[4]=q((...r)=>p.filterData&&p.filterData(...r),["prevent"]))},[e("div",Z,[x(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=r=>d.filter.name=r),id:"name",placeholder:"Name",class:"p-2 border rounded"},null,512),[[b,d.filter.name]]),e("div",G,[e("label",H,a(t.__("From"))+":",1),x(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=r=>d.filter.start_date=r),id:"start_date",class:"p-2 border rounded"},null,512),[[b,d.filter.start_date]])]),e("div",J,[e("label",Q,a(t.__("To"))+":",1),x(e("input",{type:"date","onUpdate:modelValue":s[2]||(s[2]=r=>d.filter.end_date=r),id:"end_date",class:"p-2 border rounded mr-4"},null,512),[[b,d.filter.end_date]])]),e("div",null,[_(B,{class:"width-100",size:"large",value:d.filter.study_program,"onUpdate:value":s[3]||(s[3]=r=>d.filter.study_program=r),"show-search":"",placeholder:t.__("Select a study program"),options:d.options,"filter-option":p.filterOption,onFocus:p.handleFocus,onBlur:p.handleBlur,onChange:p.handleChange},null,8,["value","placeholder","options","filter-option","onFocus","onBlur","onChange"])]),e("button",$,a(t.__("Filter")),1)])],32)]),e("div",tt,[e("div",et,[e("div",st,[at,e("div",rt,a(i.attendance_percentage)+"% Kehadiran ",1)]),e("div",ot,[nt,e("div",it,a(i.absence_percentage)+"% Ketidakhadiran ",1)])]),e("div",lt,[e("div",dt,[e("div",null,a(t.__("Attendance List")),1),e("div",ct,[_(w,{loading:!1,onClick:s[5]||(s[5]=r=>p.exportAttendance()),type:"button",theme:"sky"},{default:u(()=>[c(a(t.__("Exports")),1)]),_:1})])]),e("div",ht,[e("table",_t,[e("thead",pt,[e("tr",null,[e("th",ut,a(t.__("Name")),1),e("th",mt,a(t.__("Study Program")),1),e("th",ft,a(t.__("Date")),1),e("th",yt,a(t.__("Time In")),1),e("th",gt,a(t.__("Time Out")),1),e("th",xt,a(t.__("Lateness")),1),e("th",bt,a(t.__("Latlon In")),1),e("th",vt,a(t.__("Latlon Out")),1)])]),e("tbody",null,[l.attendanceteacher.length>0?(o(!0),n(h,{key:0},y(l.attendanceteacher,r=>(o(),n("tr",{key:r.id,class:"border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",wt,a(r.user.name),1),e("td",kt,[r.user.department&&r.user.department.study_program?(o(),n("div",Ct,a(r.user.department.study_program.name),1)):(o(),n(h,{key:1},[c(" - ")],64))]),e("td",St,a(r.date),1),e("td",Lt,a(r.time_in),1),e("td",At,a(r.time_out),1),e("td",Ot,a(r.lateness),1),e("td",Dt,a(r.latlon_in),1),e("td",Tt,a(r.latlon_out),1)]))),128)):(o(),n("tr",Bt,[e("td",Ft,[_(k,{asShow:"div"})])]))])])])])]),e("div",It,[e("div",Mt,[e("div",Nt,a(t.__("Absent List")),1),_(w,{loading:!1,onClick:s[6]||(s[6]=r=>p.exportAbsent()),type:"button",theme:"sky"},{default:u(()=>[c(a(t.__("Export")),1)]),_:1})]),_(F,null,{head:u(()=>[e("th",jt,a(t.__("Name")),1),e("th",Et,a(t.__("Study Program")),1),e("th",Rt,a(t.__("Date")),1),e("th",Ut,a(t.__("Leave Type")),1),e("th",Pt,a(t.__("Status")),1)]),body:u(()=>[i.absentTeachers.length>0?(o(!0),n(h,{key:0},y(i.absentTeachers,r=>(o(),n("tr",{key:r.id,class:"border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",Vt,a(r.name),1),e("td",qt,[r.department&&r.department.study_program?(o(),n("div",Kt,a(r.department.study_program.name),1)):(o(),n(h,{key:1},[c(" - ")],64))]),e("td",Xt,a(r.date),1),e("td",Yt,[r.leaves.length>0?(o(),n("div",zt,[(o(!0),n(h,null,y(r.leaves,(f,g)=>(o(),n("div",{key:f.id,class:"font-bold ml-0.5"},[c(a(f.type?f.type.name:"-")+" ",1),r.leaves.length!=g+1?(o(),n(h,{key:0},[c(",")],64)):A("",!0)]))),128))])):(o(),n(h,{key:1},[c(" - ")],64))]),e("td",Wt,[r.leaves.length>0?(o(),n("div",Zt,[(o(!0),n(h,null,y(r.leaves,(f,g)=>{var C;return o(),n("div",{key:f.id,class:"font-bold ml-0.5"},[c(a((C=f.status)!=null?C:"-")+" ",1),r.leaves.length!=g+1?(o(),n(h,{key:0},[c(",")],64)):A("",!0)])}),128))])):(o(),n(h,{key:1},[c(" - ")],64))])]))),128)):(o(),n("tr",Gt,[e("td",Ht,[_(k,{asShow:"div"})])]))]),_:1})]),Jt])]),_:1},8,["title"])}const _e=N(z,[["render",Qt],["__scopeId","data-v-282505a5"]]);export{_e as default};
